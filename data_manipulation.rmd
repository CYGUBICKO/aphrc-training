---
title: "Data Manipulation"
author: "Generated by Steve Cygu"
date: " `r format(Sys.time(), '%B %d, %Y')` "
output:
  pdf_document:
    number_sections: true
  html_document:
    number_sections: true
---

\newpage
\tableofcontents
\listoffigures
\listoftables
\newpage

```{r setup, echo=FALSE, purl=FALSE, warning=FALSE, message=FALSE}
## Libraries and global objects goes here
knitr::opts_chunk$set(fig.pos="H"
	, out.extra=""
	, comment=""
	, message=FALSE
	, warning=FALSE
)

## Packages
library(dplyr)
library(ggplot2)
```

\section{Summary}

We can create or use existing datasets, and perform various manipulations for various data types:

- numeric vectors
- factors

\section{Data sets}

A data frame is a table of observations. Each row contains one observation. Each observation must contain the same variables. These variables are called columns, and you can refer to them by name. You can also refer to the contents by row number and column number, just as with a matrix.

\subsection{Creating datasets}

- `data.frame`: Let us create two variables _age_ and _gender_ and combine them into a data set

```{r age_gender_df}
age <- seq(50, 100, length.out=10)
gender <- c("M", "M", "F", "M", "F", "F", "M", "M", "F", "M")
age_gender_df <- data.frame(age, gender)
print(age_gender_df)
```

<br>

We can change variable names in the `age_gender_df` created above:

- `names()`
- `colnames()`


```{r age_gender_df_names}
# Create variable names
names(age_gender_df) <- c("age", "sex")
# colnames(age_gender_df) <- c("ages", "sex")
print(age_gender_df)
```

<br>

Suppose we observe another variable (`edu_level`) indicating the education level of the respondent such that:

- `1 = No schooling`
- `2 = Secondary`
- `3 = College/University`

we can created the `edu_level` variable with these categories and labels

- `cbind.data.frame()`

```{r add_edu_level}
# Create factor/quantitative variable
edu_level <- c(1,1,1,2,3,3,2,4,1,1)
age_gender_edu_df <- cbind.data.frame(age_gender_df, edu_level)
age_gender_edu_df
```

- Add the factor levels
	- `factor()`

```{r add_edu_factor_levels}
age_gender_edu_df$edu_level <- factor(age_gender_edu_df$edu_level
	, levels=c(1,2,3)
	, labels=c("No schooling", "Secondary", "College/University")
)
age_gender_edu_df
```


\subsection{Creating pipelines}

This might come up later in the other chapters but it might make our life easier in handling dataframes and functions. 

- We can use the pipe operator (`%>%`) to make workflow easier to read and write. Originally, the pipe operator `%>%` is from `magrittr` package but we are mainly going to use the `tidyverse` version from package `dplyr`, i.e., `library(dplyr)` in `setup` chunk.


```{r pipe_example}
## Print the first few observations
### Base R
head(age_gender_edu_df)

### Using pipe
age_gender_edu_df %>% head()
```

<br>

The pipe operator does not provide any new functionality to R, but it can greatly improve the readability of code. The pipe operator takes the output of the function or object on the left of the operator and passes it as the first argument of the function on the right.

- The difference doesn't seem much in this example but with complicated examples, we may start seeing the benefits. For example, in our previous example to create `edu_level`, we use `%>%`

```{r pipe_edu_level}
age_gender_edu_df <- (age_gender_df
	%>% mutate(edu_level=edu_level
		, edu_level=factor(edu_level, levels=c(1,2,3)
			, labels=c("No schooling", "Secondary", "College/University")
		)
	)
)
age_gender_edu_df
```

<br>

Now let us try to build a pipeline:

- drop observations with missind `edu_level`
- select `gender` and `age` columns
- generate a box plot of `age` and `gender` using `ggplot`


```{r simple_pipeline}
data_summary <- (age_gender_edu_df
	%>% filter(!is.na(edu_level))
	%>% select(age, sex)
	%>% ggplot(aes(x=sex, y=age)) + stat_summary() #+ theme_bw()
)
print(data_summary)
```

\subsection{Reading data from other sources}

**R** can read data created in various formats (SPSS, SAS, Stata, Excel, CSV, TXT, etc).
